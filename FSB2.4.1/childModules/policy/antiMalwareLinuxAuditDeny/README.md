# policy/antiMalwareLinuxAuditDeny/policy.bicep
Bicep module to create Azure policy resources.

## Module Features
This module deploys 1 Azure policy definition & 1 policy assignment.

This policy will deny the AntiMalware extension being installed on Linux Virtual Machines. It does this by checking the Virtual Machine OS image and if the Antimalware tag is set on the Virtual Machine.

## Resource types

| Resource Type | API Version |
| --- | --- |
| `Microsoft.Authorization/policyDefinitions` | [2021-06-01](https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/2021-06-01/policydefinitions) |
| `Microsoft.Authorization/policyAssignments` | [2021-06-01](https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/2021-06-01/policyassignments) |


## Module Example Use
```bicep
module examplePolicy '../childModules/policy/antiMalwareLinuxAuditDeny/policy.bicep' = {
  name: 'deployExamplePolicy'
  params: {
    policyMetadata:'EvidenELZ'
    policyRuleTag:'EvidenAntiMalware'
    antimalwareLinuxEffect: 'Deny'
    antiMalwareLinuxAuditDenyDefName: 'antimalwarelinux.auditdeny.policy.def'
    antiMalwareLinuxAuditDenyDefDisplayName: 'Antimalware Linux auditdeny policy definition'
    antiMalwareLinuxAuditDenyDefAssignmentName: 'antimalwarelinux.auditdeny.policy.def.assignment'
    antiMalwareLinuxAuditDenyDefAssignmentDisplayName: 'Antimalware Linux auditdeny policy definition assignment'
  }
}
```

## Module Parameters

| Name | Type | Required | Description |
| --- | --- | --- | --- |
| `antimalwareLinuxEffect` | `string` | true | Desired effect to set, when an antimalware tag attached to a Linux Virtual Machine is detected. |
| `antiMalwareLinuxAuditDenyDefName` | `string` | true | Specify name for antimalware linux audit deny policy. |
| `antiMalwareLinuxAuditDenyDefDisplayName` | `string` | true | Specify display name for antimalware linux audit deny policy. |
| `antiMalwareLinuxAuditDenyDefAssignmentName` | `string` | true | Specify name for assignment of antimalware linux audit deny policy. |
| `antiMalwareLinuxAuditDenyDefAssignmentDisplayName` | `string` | true | Specify display name for assignment of antimalware linux audit deny policy. |
| `policyMetadata` | `string` | true | Specify metadata source value required for billing and monitoring. |
| `policyRuleTag` | `string` | true | Tag used for the policy rule. |


## Module Outputs
None.

## Parameters file example
```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "antimalwareLinuxEffect": {
            "value": "Deny"
        },
        "antiMalwareLinuxAuditDenyDefName":{
            "value": "antimalwarelinux.auditdeny.policy.def"
        },
        "antiMalwareLinuxAuditDenyDefDisplayName":{
            "value": "Antimalware linux auditdeny policy definition"
        },
        "antiMalwareLinuxAuditDenyDefAssignmentName":{
            "value": "antimalwarelinux.auditdeny.policy.def.assignment"
        },
        "antiMalwareLinuxAuditDenyDefAssignmentDisplayName":{
            "value": "Antimalware linux auditdeny policy definition assignment"
        },
        "policyMetadata": {
            "value": "EvidenELZ"
        },
        "policyRuleTag": {
            "value": "EvidenAntiMalware"
        }
    }
}
```