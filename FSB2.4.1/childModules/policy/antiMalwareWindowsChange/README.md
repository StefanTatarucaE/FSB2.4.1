# policy/antiMalwareWindowsChange/policy.bicep
Bicep module to create Azure policy resources.

## Module Features
This module deploys 1 Azure policy definition, 1 policy assignment & 1 role assignment.

This policy will deploy the Anti-Malware agent for Windows Virtual Machines if the agent is not installed.

## Resource types

| Resource Type | API Version |
| --- | --- |
| `Microsoft.Authorization/policyDefinitions` | [2021-06-01](https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/2021-06-01/policydefinitions) |
| `Microsoft.Authorization/policyAssignments` | [2021-06-01](https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/2021-06-01/policyassignments) |
| `Microsoft.Authorization/roleAssignments` (via RoleAssignment module) | [2020-10-01-preview](https://docs.microsoft.com/en-us/azure/templates/microsoft.authorization/2020-10-01-preview/roleassignments) |


## Module Example Use
```bicep
module examplePolicy '../childModules/policy/antiMalwareWindowsChange/policy.bicep' = {
  name: 'deployExamplePolicy'
  params: {
    scheduledScanSettings: {
      isEnabled: 'false'
      scanType: 'Quick'
      day: '7'
      time: '120'
    }
    policyRuleTag:[
      'EvidenManaged'
      'EvidenAntiMalware'
      ]
    policyMetadata: 'EvidenELZ'
    antiMalwareWindowsChangeDefName: 'antimalwarewindows.change.policy.def'
    antiMalwareWindowsChangeDefDisplayName: 'Managedos-deploy anti-malware agent for windows vms'
    antiMalwareWindowsChangeDefAssignmentName: 'antimalwarewindows.change.policy.def.assignment'
    antiMalwareWindowsChangeDefAssignmentDisplayName: 'Antimalware windows change policy definition assignment'
  }
}
```

## Module Parameters

| Name | Type | Required | Description |
| --- | --- | --- | --- |
| `scheduledScanSettings` | `object` | true | object for custom scheduled scan settings. For information on each setting please refer block A. Additional Details [here](#array---scheduledscansettings).|
| `antiMalwareWindowsChangeDefName` | `string` | true | Specify name of policy definition for antiMalware Windows Change policy. |
| `antiMalwareWindowsChangeDefDisplayName` | `string` | true | Specify display name of policy definition for antiMalware Windows Change policy. |
| `antiMalwareWindowsChangeDefAssignmentName` | `string` | true | Specify name of policy assignment for antiMalware Windows Change policy definition. |
| `antiMalwareWindowsChangeDefAssignmentDisplayName` | `string` | true | Specify display name of policy assignment for antiMalware Windows Change policy definition. |
| `deployLocation` | `string` | true | Parameter used to return the current location of the deployment. The parameter is specifically used for naming the deployment |
| `policyMetadata` | `string` | true | Specify metadata source value required for billing and monitoring. |
| `policyRuleTag` | `array` | true | Tags used for the policy rule. |


### Array - scheduledScanSettings

| Name| Type | Description |
| --- | --- |  --- |
| `isEnabled` | `string`  |Indicates whether or not custom scheduled scan settings are enabled (default is false). |
| `scanType` | `string`  | Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick). |
| `day` | `string`  | Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday). |
| `time` | `string` | When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM. |

## Module Outputs

| Name | Description | Value |
| --- | --- | --- |
| `roleAssignmentDeployName` | Object containing the Role Assigment Deployment Name. | `policySystemManagedIdentityRoleAssignment.name` |

## Parameters file example
```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "scheduledScanSettings": {
            "value": {
                "isEnabled": "false",
                "scanType": "Quick",
                "day": "7",
                "time": "120"
            }
        },
        "antiMalwareWindowsChangeDefName": {
            "value": "antimalwarewindows.change.policy.def"
        },
        "antiMalwareWindowsChangeDefDisplayName": {
            "value": "Managedos-deploy anti-malware agent for windows vms"
        },
        "antiMalwareWindowsChangeDefAssignmentName": {
            "value": "antimalwarewindows.change.policy.def.assignment"
        },
        "antiMalwareWindowsChangeDefAssignmentDisplayName": {
            "value": "Antimalware windows change policy definition assignment"
        },
        "policyMetadata": {
            "value": "EvidenELZ"
        }
    }
}
```