# Bootstrap Parent module

Azure Bicep parent module to create the Bootstrap resources for the Eviden Landingzones for Azure solution.

## Description

This parent module calls the storageAccount child module in the childModules folder and deploys a storage account required for the bootstrap solution in the mgmt subscription.

The following resources are created:

- A resource group for the resource(s).
- A storageAccount.
- Containers (on the storageAccount) which are used for storing artifacts.

### Naming convention module

To ensure & enforce the required naming convention, the helper naming module is used by all other child modules.
The names being generated by the naming module are the actual resource names which are used on the Azure platform.

The naming convention module is run in a previous stage of the workflow. The output from the module is saved to a file and published as a workflow artifact. In subsequent jobs the artifact is downloaded and used by Bicep parent modules.

The downloaded artifact is referenced by parent modules by declaring a '*Naming' variable.  For example: `var mgmtNaming = json(loadTextContent('../../mgmtNaming.json'))`

## Parent module overview

The parent module has been configured as follows:

1. First the output of the naming module is loaded via a variable.
2. The resource group is defined next.
3. After the resource group block, the storage account is defined.

### Parent module parameters

**Required parameters**

None

**Optional parameters**

| Parameter Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `additionalBootstrapTags` | `object` | `{}` | A mapping of additional tags to assign to the resource group. |

## Example parameters file

The required values for parameters are described in the following example of a parameters file.
The values mentioned in this example are **not** default and **must** be defined for the parent module to run successfully.

```json
{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "additionalBootstrapTags": {
      "value": {}
    }
  }
}
```

## ELZ Azure Configuration Values

The parentModule folder (where the bootstrap.bicep file resides) contains a `parentModuleConfig.json` file. This json file holds the default configuration for the Bootstrap storage account deployment. The values from the json file maps to the storageAccount child module parameters.

The `parentModuleConfig.json` file is referenced by the Bootstrap parent module by declaring a 'parentModuleConfig' variable; `var parentModuleConfig = loadJsonContent('parentModuleConfig.json')`.

In the following table the configuration defaults are described.

| Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `kind` | `string` | `StorageV2` | Microsofts recommends `StorageV2` for storage accounts. The ELZ default configuration follows this recommendation. |
| `sku` | `string` | `Standard_LRS` | The blobs saved on this container can easily be recreated/re-uploaded using the source in the GitHub repository, there is no need for extra redundancy. This is why the sku is set to `Standard_LRS`. |
| `accessTier` | `string` | `Hot` | Blobs on this storage account need to be available immediately during deployments. So, the default is set to `Hot`. |
| `allowBlobPublicAccess` | `bool` | `false` | As a default `public access` to Blobs is not allowed. |
| `networkAcls` | `object` | `{bypass: 'AzureServices, Logging, Metrics', defaultAction: 'Allow', ipRules: '[]'}` | The ELZ default configuration for access to the storage account via network is as follows: `AzureServices, Logging & Metrics` will bypass any restrictions. The default action when no other rules match is to `Allow` the traffic. No `IP addresses` are set as allowed in the storage account firewall. |
| `changeFeed` | `object` | `{enabled: 'true', retentionInDays: '7'}`| It is best practice to enable `change feed` to track changes (on blobs & blob metadata). ELZ default is to set the logging to 7 days.|
| `blobSvcDeleteRetentionPolicy` | `object` | `{enabled: 'true', retentionInDays: '7'}` | ELZ default is to `retain` deleted blobs for 7 days. |
| `shouldCreateContainers` | `bool` | `true` | The value is true so that the necessary container is created. |

For more information on the storage account parameters, for which these default values are set please check the storageAccount child module [README](../../childModules/storageAccount/README.md).

> **Note**
> 
> It is recommended to only change these values after consulting the ELZ Azure engineering team.
## Outputs

None.
