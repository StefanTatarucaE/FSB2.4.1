# VM OS Management Parent module

Azure Bicep parent module to deploy the VM OS Management related resources.

## Description

This parent module calls several child modules in the `childModules` folder to deploy the resources, which together form the VM OS Management solution.

The VM OS Management solution consists of the following separate components (set of resources which deliver 1 specific functionality):

| Nr. | Functionality | Provided by | Deployed in | Optional |
| :-- | :-- | :-- | :-- | :-- |
| 1. | OS Update management | Update Manager | mgmt | Update Manager is optional |
| 2. | Custom Image structure & organization for VMs | Compute Gallery (formerly known as Shared Image Gallery) | mgmt | yes |
| 3. | OS Version information provided via Tag | Azure Function - pwsh code | mgmt | no |
| 4. | Backups for VMs | Recovery Services Vault & Azure DINE policy | lndz, tool | yes |
| 5. | Disk Encryption for VMs | Azure KeyVault & Disk Encryption Set | lndz, tool | yes |

To select or de-select the deployment of an optional component use the corresponding booleans.

* **deployUpdateManager** for deploying the update manager & the configured maintenance configurations.
* **deployComputeGallery** for deploying the Custom Image structure & organization for VMs.
* **deployRecoveryServicesVault** for deploying the Backup for VMs.
* **deployDiskEncryption** for deploying the Disk Encryption for VMs.

In the following paragraphs the resources which are deployed per component are described.

### OS Update management

For the _OS Update management_ component the following resources are deployed:

* A resource group to hold all related resources. (which are the configured maintenance configurations)
* Maintenance configurations as provided by the input files.

### Custom Image structure & organization for VM

For the _Custom Image structure & organization for VM_ component the following resources are deployed:

* A resource group to hold all related resources.
* A storage account where all the custom images van be uploaded.
* A Compute Gallery.

### OS Version information provided via Tag

For the _OS Version information provided via Tag_ component the following resources are deployed:

* A resource group to hold all related resources.
* A storage account to be used by the OS Tagging Azure FunctionApp.
* OS Tagging Azure FunctionApp resources (An App Service Plan, a FunctionApp & Application Insights).

### Backups for VMs

For the _Backups for VMs_ component the following resources are deployed:

* A resource group to hold all related resources.
* A Recovery Services Vault including backup policies configurations.
* Azure DINE policies which configures backup for VMs in the deployed Recovery Services vault.

### Disk encryption for VMs

For the _Disk encryption for VMs_ component the following resources are deployed:

* A resource group to hold all related resources.
* A Key vault including configuration for use with the Disk Encryption Set (VM Encryption solution).
* A Disk Encryption Set.

### Naming convention module

To ensure & enforce the required naming convention, the helper naming module is used by all other child modules.
The names being generated by the naming module are the actual resource names which are used on the Azure platform.

The naming convention module is run in a previous stage of the workflow. The output from the module is saved to a file and published as a workflow artifact. In subsequent jobs the artifact is downloaded and used by Bicep parent modules.

The downloaded artifact is referenced by parent modules by declaring a '*Naming' variable. For example: `var mgmtNaming = json(loadTextContent('../../mgmtNaming.json'))`

## Parent module parameters

**Required parameters**

| Parameter Name | Type | Description |
| :-- | :-- | :-- |
| `subscriptionType` | `string` | Specifies to which subscription type, to deploy the template. To be provided by the pipeline.' |

**Optional parameters**

| Parameter Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `deployUpdateManager` | `bool` | `false` | Specifies if the _OS Update management_ component is to be deployed.|
| `deployComputeGallery` | `bool` | `false` | Specifies if the _Custom Image structure & organization for VMs_ component is to be deployed.|
| `deployRecoveryServicesVault` | `bool` | `false` | Specifies if the _Backups for VMs component_ is to be deployed.|
| `deployDiskEncryption` | `bool` | `false` | Specifies if the _Disk encryption for VMs_ component is to be deployed.|
| `additionalUpdateManagerTags` | `object` | `{}` | Specifies a mapping of tags to assign to resourcegroup related to the Update Manager Solution|
| `additionalmaintenanceConfigurationsTags` | `object` | `{}` | Specifies a mapping of tags to assign to the maintenance configurations (aka 'Patch Schedules').|
| `maintenanceConfigurations` | `array` | `[]` | Specifies the JSON structure used to specify the maintenance configurations to be created. See the example parameter for extra information.|
| `additionalOsTaggingTags` | `object` | `{}` | Specifies a mapping of additional tags to assign to resources of the _OS Version information provided via Tag_ component. |
| `computeGalleryDescription` | `string` | `Shared Image Gallery` | Specifies the description for the Compute Gallery to be deployed. |
| `additionalComputeGalleryTags` | `object` | `{}` | Specifies a mapping of additional tags to assign to resources of the _Custom Image structure & organization for VM_ component. |
| `additionalRecoveryServicesVaultTags` | `object` | `{}` | Specifies a additional mapping of tags to assign to resources of the _Backups for VMs_ component. |
| `backupPolicyConfigurations` | `object` | `{}` | Specifies the JSON structure for the backup policy configuration to be created. See the example parameter for extra information.|
| `diskEncryptionKeyVaultKeyConfig` | `object` | `{}` | Specifies the JSON structure for the key rotation policy configuration to be created. |
| `diskEncryptionDeploymentRegions` | `array` | `[]` | Specifies the Azure regions to use for deploying the Azure KeyVaults & Disk Encryption sets. For example `westeurope` & `northeurope`.|
| `additionalDiskEncryptionTags` | `object` | `{}` | Specifies a mapping of additional tags to assign to resources of the _Disk encryption for VMs_ component. |
| `currentTime` | `string` | `utcNow('u')` | Specifies the current time when the parent runs which is later used to calculate the start of the maintenance configuration. |

### diskEncryptionKeyVaultKeyConfig Object parameter details

| Name | Type | Description |
| :--  | :--  | :-- |
| `lifetimeActions` | `array` | An array of trigger/action pair objects describing the behaviour of the key during its life cycle. |
| `trigger` | `object` | Object holding the trigger definition for a particular lifetimeAction. |
| `timeAfterCreate` | `string` | Specifies at what time after creation of a key the action from this particular lifetimeAction will take place. Defined in ISO 8601 format. Eg: 'P90D', 'P1Y'.|
| `timeBeforeExpiry` | `string` | Specifies at what time before expiration of a key the action from this particular lifetimeAction will take place. Defined in ISO 8601 format. |
| `action` | `string` | Specifies the action to be taken at trigger time. Valid options are `rotate` and `notify`. The rotate option creates a new version of the key, the notify option generates an EventGrid event. |
| `attributes` | `object` | Placeholder object for `expiryTime` property |
| `expiryTime` | `string` | Specifies the expiration time for the new key version. It should be in ISO8601 format. Eg: 'P90D', 'P1Y'. |

## Example parameters file for mgmt deployments

The required values for parameters are described in the following example of a parameters file.
The values mentioned in this example are **not** default and **must** be defined for the parent module to run successfully.

<details><summary>mgmt paramater example</summary>

## Example mgmt parameters file

The required parameter values for deployment in a management subscription are described in the following example.

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "deployUpdateManager": {
            "value": true
        },
        "deployComputeGallery": {
            "value": true
        },
        "additionalUpdateManagerTags": {
            "value": {}
        },
        "additionalmaintenanceConfigurationsTags": {
            "value": {}
        },
        "additionalmaintenanceConfigurationsTags": {
            "value": {}
        },
        "maintenanceConfigurations": {
            "value": [
                {
                    "maintenanceConfigurationName": "linux-dev",
                    "installPatches": {
                        "linuxParameters": {
                            "classificationsToInclude": ["Security",
                            "Critical"],
                            "packageNameMasksToExclude": [],
                            "packageNameMasksToInclude": []
                        },
                        "rebootSetting": "ifRequired",
                        "windowsParameters": {
                            "classificationsToInclude": [],
                            "excludeKbsRequiringReboot": false,
                            "kbNumbersToExclude": [],
                            "kbNumbersToInclude": []
                        }
                    },
                    "maintenanceWindow": {
                        "duration": "03:55",
                        "expirationDateTime": "9999-12-31 23:59:59",
                        "recurEvery": "1Day",
                        "startTime": "15:00",
                        "timeZone": "W. Europe Standard Time"
                    }
                },
                {
                    "maintenanceConfigurationName": "windows-dev",
                    "installPatches": {
                        "linuxParameters": {
                            "classificationsToInclude": [],
                            "packageNameMasksToExclude": [],
                            "packageNameMasksToInclude": []
                        },
                        "rebootSetting": "ifRequired",
                        "windowsParameters": {
                            "classificationsToInclude": ["Security",
                            "Critical"],
                            "excludeKbsRequiringReboot": false,
                            "kbNumbersToExclude": [],
                            "kbNumbersToInclude": []
                        }
                    },
                    "maintenanceWindow": {
                        "duration": "03:55",
                        "expirationDateTime": "9999-12-31 23:59:59",
                        "recurEvery": "1Day",
                        "startTime": "15:00",
                        "timeZone": "W. Europe Standard Time"
                    }
                }
            ]
        },
        "computeGalleryDescription": {
            "value": "Shared Image Gallery"
        },
        "additionalComputeGalleryTags": {
            "value": {}
        },
        "additionalOsTaggingTags": {
            "value": {}
        }
    }
}
```

## Example parameters file for lndz deployments

The required values for parameters are described in the following example of a parameters file.
The values mentioned in this example are **not** default and **must** be defined for the parent module to run successfully.

lndz parameter example

```json
{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "deployRecoveryServicesVault": {
            "value": true
        },
        "deployDiskEncryption": {
            "value": true
        },
        "additionalRecoveryServicesVaultTags": {
            "value": {}
        },
        "backupPolicyConfigurations": {
            "value": {
                "list": [
                    {
                        "backupTagNamePrefix": "Bronze",
                        "scheduleStartTime": "09:00",
                        "properties": {
                            "policyType": "V2",
                            "backupManagementType": "AzureIaasVM",
                            "instantRpRetentionRangeInDays": "5",
                            "schedulePolicy": {
                                "scheduleRunFrequency": "Daily",
                                "scheduleRunDays": null,
                                "schedulePolicyType": "SimpleSchedulePolicyV2"
                            },
                            "retentionPolicy": {
                                "dailySchedule": {
                                    "retentionDuration": {
                                        "count": "15",
                                        "durationType": "Days"
                                    }
                                },
                                "weeklySchedule": {
                                    "daysOfTheWeek": [
                                        "Sunday",
                                        "Tuesday",
                                        "Thursday"
                                    ],
                                    "retentionDuration": {
                                        "count": "8",
                                        "durationType": "Weeks"
                                    }
                                },
                                "monthlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "6",
                                        "durationType": "Months"
                                    }
                                },
                                "yearlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "monthsOfYear": [
                                        "January",
                                        "March",
                                        "August"
                                    ],
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "2",
                                        "durationType": "Years"
                                    }
                                },
                                "retentionPolicyType": "LongTermRetentionPolicy"
                            },
                            "timeZone": "UTC"
                        }
                    },
                    {
                        "backupTagNamePrefix": "Silver",
                        "scheduleStartTime": "09:00",
                        "properties": {
                            "policyType": "V2",
                            "backupManagementType": "AzureIaasVM",
                            "instantRpRetentionRangeInDays": "5",
                            "schedulePolicy": {
                                "scheduleRunFrequency": "Daily",
                                "scheduleRunDays": null,
                                "schedulePolicyType": "SimpleSchedulePolicyV2"
                            },
                            "retentionPolicy": {
                                "dailySchedule": {
                                    "retentionDuration": {
                                        "count": "15",
                                        "durationType": "Days"
                                    }
                                },
                                "weeklySchedule": {
                                    "daysOfTheWeek": [
                                        "Sunday",
                                        "Tuesday",
                                        "Thursday"
                                    ],
                                    "retentionDuration": {
                                        "count": "8",
                                        "durationType": "Weeks"
                                    }
                                },
                                "monthlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "6",
                                        "durationType": "Months"
                                    }
                                },
                                "yearlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "monthsOfYear": [
                                        "January",
                                        "March",
                                        "August"
                                    ],
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "2",
                                        "durationType": "Years"
                                    }
                                },
                                "retentionPolicyType": "LongTermRetentionPolicy"
                            },
                            "timeZone": "UTC"
                        }
                    },
                    {
                        "backupTagNamePrefix": "Gold",
                        "scheduleStartTime": "09:00",
                        "properties": {
                            "policyType": "V2",
                            "backupManagementType": "AzureIaasVM",
                            "instantRpRetentionRangeInDays": "5",
                            "schedulePolicy": {
                                "scheduleRunFrequency": "Daily",
                                "scheduleRunDays": null,
                                "schedulePolicyType": "SimpleSchedulePolicyV2"
                            },
                            "retentionPolicy": {
                                "dailySchedule": {
                                    "retentionDuration": {
                                        "count": "15",
                                        "durationType": "Days"
                                    }
                                },
                                "weeklySchedule": {
                                    "daysOfTheWeek": [
                                        "Sunday",
                                        "Tuesday",
                                        "Thursday"
                                    ],
                                    "retentionDuration": {
                                        "count": "8",
                                        "durationType": "Weeks"
                                    }
                                },
                                "monthlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "6",
                                        "durationType": "Months"
                                    }
                                },
                                "yearlySchedule": {
                                    "retentionScheduleFormatType": "Daily",
                                    "monthsOfYear": [
                                        "January",
                                        "March",
                                        "August"
                                    ],
                                    "retentionScheduleDaily": {
                                        "daysOfTheMonth": [
                                            {
                                                "date": 1,
                                                "isLast": false
                                            }
                                        ]
                                    },
                                    "retentionScheduleWeekly": null,
                                    "retentionDuration": {
                                        "count": "2",
                                        "durationType": "Years"
                                    }
                                },
                                "retentionPolicyType": "LongTermRetentionPolicy"
                            },
                            "timeZone": "UTC"
                        }
                    }
                ]
            }
        },
        "diskEncryptionKeyRotationEnabled":{
            "value": true
        },
        "diskEncryptionKeyVaultKeyConfig": {
            "value": {
                "keyVaultKeyRotationPolicy": {
                    "lifetimeActions": [
                        {
                            "trigger": {
                                "timeAfterCreate": "P80D"
                            },
                            "action": {
                                "type": "rotate"
                            }
                        },
                        {
                            "trigger": {
                                "timeBeforeExpiry": "P10D"
                            },
                            "action": {
                                "type": "notify"
                            }
                        }
                    ],
                    "attributes": {
                        "expiryTime": "P3M"
                    }
                }
            }
        },
        "diskEncryptionDeploymentRegions": {
            "value": [
                "northeurope",
                "westeurope"
            ]
        },
        "additionalDiskEncryptionTags": {
            "value": {}
        }
    }
}
```

</details>

## ELZ Azure Configuration Values

The parentModule folder (where the vmosmanagement.bicep file resides) contains a `parentModuleConfig.json` file. This json file holds the default configuration for the VM OS Management component resources deployments. The values from the json file maps to child module parameters.

Furthermore the parentModule folder contains the following files: `evgs-func-ostagging.json` &
`evgs-rb-osdiskencrypt.json`. These files contain the configuration for the eventgrid subscription used for the OS tagging function app & the disk encryption webhook.

### Management specific configuration values

The `parentModuleConfigMgmt.json` file is referenced by the vmosmanagement parent module 2 times, targeting 2 separate json sections.
The `mgmt` related key value pairs are targeted using the 'parentModuleConfigMgmt' variable; `var parentModuleConfigMgmt = loadJsonContent('parentModuleConfig.json', 'management')`.

In the following table the `mgmt` configuration defaults are described.

| Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `vmOsManagementAutomationAccountSkuName` | `string` | `Free` | The default sku for the Automation Account used for Update management. |
| `vmOsManagementManagedIdentity` | `object` | `{"systemAssignedIdentity": true,"userAssignedIdentities": {}}` | ELZ default is to use system managed identities throughout the Eviden Landingzone for Azure product. |
| `computeGalleryStorageAccountKind` | `string` | `StorageV2` | Microsofts recommends `StorageV2` for storage accounts. The ELZ default configuration follows this recommendation. |
| `computeGalleryStorageAccountSku` | `string` | `Standard_LRS` | The blobs saved on this container can easily be recreated/re-uploaded, there is no need for extra redundancy. This is why the sku is set to `Standard_LRS`. |
| `computeGalleryStorageAccountAccessTier` | `string` | `Hot` | Blobs on this storage account need to be available immediately during deployments. So, the default is set to `Hot`. |
| `computeGalleryStorageAccountAllowBlobPublicAccess` | `bool` | `false` | As a default `public access` to Blobs is not allowed. |
| `computeGalleryStorageAccountNetworkAcls` | `object` | `{"bypass": 'AzureServices, Logging, Metrics', "defaultAction": 'Allow', "ipRules": '[]'}` | The ELZ default configuration for access to the storage account via network is as follows: `AzureServices, Logging & Metrics` will bypass any restrictions. The default action when no other rules match is to `Allow` the traffic. No `IP addresses` are set as allowed in the storage account firewall. |
| `computeGalleryStorageAccountChangeFeed` | `object` | `{"enabled": 'true', "retentionInDays": '7'}`| It is best practice to enable `change feed` to track changes (on blobs & blob metadata). ELZ default is to set the logging to 7 days.|
| `computeGalleryStorageAccountBlobSvcDeleteRetentionPolicy` | `object` | `{"enabled": 'true', "retentionInDays": '7'}` | ELZ default is to `retain` deleted blobs for 7 days. |
| `computeGalleryStorageAccountShouldCreateContainers` | `bool` | `true` | The value is true so that the necessary containers are created. |
| `computeGalleryStorageAccountArtifactContainerNames` | `array` | `[{"containerName": "vhdcheck","containerAccess": "None"},{"containerName": "vhdupload","containerAccess": "None"},{"containerName": "vhdready","containerAccess": "None"}]` | The containers created are used by the multiple stages when creating a custom image in a Compute Gallery.|
| `osTaggingStorageAccountKind` | `string` | `StorageV2` | Microsofts recommends `StorageV2` for storage accounts. The ELZ default configuration follows this recommendation. |
| `osTaggingStorageAccountSku` | `string` | `Standard_LRS` | The blobs saved on this container are relevant to the OS Tagging functonApp and is not critical. There is no need for extra redundancy. This is why the sku is set to `Standard_LRS`. |
| `osTaggingStorageAccountAccessTier` | `string` | `Hot` | Blobs on this storage account need to be available immediately during deployments. So, the default is set to `Hot`. |
| `osTaggingStorageAccountAllowBlobPublicAccess` | `bool` | `false` | As a default `public access` to Blobs is not allowed. |
| `osTaggingStorageAccountNetworkAcls` | `object` | `{"bypass": 'AzureServices, Logging, Metrics', "defaultAction": 'Allow', "ipRules": '[]'}` | The ELZ default configuration for access to the storage account via network is as follows: `AzureServices, Logging & Metrics` will bypass any restrictions. The default action when no other rules match is to `Allow` the traffic. No `IP addresses` are set as allowed in the storage account firewall. |
| `osTaggingStorageAccountChangeFeed` | `object` | `{"enabled": 'true', "retentionInDays": '7'}`| It is best practice to enable `change feed` to track changes (on blobs & blob metadata). ELZ default is to set the logging to 7 days.|
| `osTaggingStorageAccountBlobSvcDeleteRetentionPolicy` | `object` | `{"enabled": 'true', "retentionInDays": '7'}` | ELZ default is to `retain` deleted blobs for 7 days. |
| `osTaggingAppServicePlanConfig` | `object` | `{"sku": {"name": "Y1","tier": "Dynamic"},"kind": "Functionapp"}` | Specifies defaults for the OS Tagging AppService Plan configuration. |
| `osTaggingAppInsightsConfig` | `object` | `{"kind": "web","properties": {"Request_Source": "IbizaWebAppExtensionCreate"}},` | Specifies defaults for the OS Tagging AppInsights configuration. |
| `osTaggingAppServiceKind` | `string` | `functionapp` | Specifies the default AppService kind. Defines the UX of the Microsoft.Web\Sites resource in the Azure Portal. `functionapp` defines it as Function Code App for pwsh. |
| `osTaggingAppServiceProperties` | `object` | `[{"name": "FUNCTIONS_EXTENSION_VERSION","value": "~4"},{"name": "FUNCTIONS_WORKER_RUNTIME","value": "powershell"},{"name": "FUNCTIONS_WORKER_RUNTIME_VERSION","value": "7.2"},{"name": "PSWorkerInProcConcurrencyUpperBound","value": "6"},{"name": "WEBSITE_RUN_FROM_PACKAGE","value": "1"}]` | The default ELZ Azure configuration for the OS Tagging Azure FunctionApp. Array of elements with required key and value pairs for the OS Tagging FunctionApp runtime environment variables. |
| `osTaggingAppServiceSiteConfig` | `object` | `{"http20Enabled": true,"minTlsVersion": "1.2","ftpsState": "FtpsOnly","powerShellVersion": "~7"}` | Array of elements with the default key value pairs for the OS Tagging AppService Site configuration settings. |
| `osTaggingAppServiceConfig` | `object` | `{"clientAffinityEnabled": false,"clientCertEnabled": false,"httpsOnly": true}` | Specifies defaults for the OS Tagging AppService Site configuration. |
| `maintenanceScope` | `string` | `InGuestPatch` | sets maintenanceScope of the configuration. |

### Landingzone specific configuration values

The `lndz` and `tool` related key value pairs are targeted using the 'parentModuleConfigLndz' variable; `var parentModuleConfigLndz = loadJsonContent('parentModuleConfigLndz.json', 'landingzone')`.

In the following table the `lndz` and `tool` configuration defaults are described.

| Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `backupStorageConfig` | `object` | `{"storageType": "GeoRedundant","storageTypeState": "Unlocked"}` | Sets the default for Azure Recovery Services storage type. Backups should be highly available, this is why it is set to `GeoRedundant`. |
| `diskEncryptionkeyVaultFeatures` | `object` | `{"enabledForDeployment": true,"enabledForDiskEncryption": true,"enabledForTemplateDeployment": true,"enablePurgeProtection": true,"enableRbacAuthorization": false,"enableSoftDelete": true}` | These key value pairs for Azure KeyVault configuration properties are all set to `true` to ensure Disk Encryption is possible & functions as desired. |
| `diskEncryptionKeyVaultConfig` | `object` | `{"skuName": "standard","publicNetworkAccess": "enabled","networkRuleBypassOptions": "AzureServices","networkRuleAction": "Allow","softDeleteRetentionInDays": 7}` | The ELZ default configuration for Azure KeyVault configuration. Specifies values for sku, access & soft delete retention of the deployed Azure KeyVault. |
| `diskEncryptionkeyVaultKeyConfig` | `object` | `{"keyEnabled": true,"keySize": 2048,"keyType": "RSA"}` | The ELZ default configuration for Azure KeyVault keys. |

For more information on the child module parameters, for which these default values are set please check the specific child module [READMEs](../../childModules/--childModuleName--/README.md).

In the following table the configuration defaults within the `evgs-func-ostagging.json` file are described.
| Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `resourceType` | `string` | `Microsoft.Web/sites` | The eventgrid subscription resourcetype. |
| `resourceTagName` | `string` | `EvidenPurpose` | The ELZ resource tag name. |
| `resourceTagValue` | `string` | `FuncOsTagging"` | The ELZ resource tag value. |
| `functionName` | `string` | `checkForSupportingOsVm` | The function name. |
| `advancedFilters` | `array` | `[{"operator": "StringBeginsWith","key": "data.operationName", "Values": ["Microsoft.Compute/virtualMachines/write", "Microsoft.Compute/virtualMachines/start/action"]}, {"operator": "StringBeginsWith", "key": "data.authorization.action", "Values":["Microsoft.Resources/tags/write", "Microsoft.EventGrid/eventSubscriptions/write", "Microsoft.Compute/virtualMachines/write"]}]` | Holds the data.operationName & data.authorization.action filter for the eventgrid subscription |
| `includedEventType` | `array` | `["Microsoft.Resources.ResourceDeleteSuccess", "Microsoft.Resources.ResourceWriteSuccess", "Microsoft.Resources.ResourceActionSuccess"]` | Holds the event type filter for the eventgrid subscription |

In the following table the configuration defaults within the `evgs-rb-osdiskencrypt.json` file are described.
| Name | Type | Default Value | Description |
| :-- | :-- | :-- | :-- |
| `resourceType` | `string` | `Microsoft.Logic/workflows` | The eventgrid subscription resourcetype. |
| `resourceTagName` | `string` | `EvidenPurpose` | The ELZ resource tag name. |
| `resourceTagValue` | `string` | `RunbookOsDiskEncrypt` | The ELZ resource tag value. |
| `functionName` | `string` | `` | The function name. |
| `advancedFilters` | `array` | `[{"operator": "StringBeginsWith", "key": "data.operationName","Values": ["Microsoft.Compute/virtualMachines/write"]}, {"operator": "StringBeginsWith","key": "data.authorization.action", "Values": [ "Microsoft.Resources/tags/write"]}]` | Holds the data.operationName & data.authorization.action filter for the eventgrid subscription |
| `includedEventType` | `array` | `["Microsoft.Resources.ResourceDeleteSuccess", "Microsoft.Resources.ResourceWriteSuccess"]` | Holds the event type filter for the eventgrid subscription |

> **Note**
>
> It is recommended to only change these values after consulting the ELZ Azure engineering team.

## Outputs

None.
