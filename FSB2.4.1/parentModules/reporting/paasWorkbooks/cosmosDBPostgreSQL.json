{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "value::all"
              ],
              "parameters": [
                {
                  "id": "f5f66862-c38c-4c25-98fa-ad1e7f463a0f",
                  "version": "KqlParameterItem/1.0",
                  "name": "subscriptionPicker",
                  "label": "Subscription",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions\"\r\n| project subscriptionId, name\r\n| order by name asc\r\n",
                  "crossComponentResources": [
                    "value::all"
                  ],
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "b1ae8eeb-0570-482d-af41-aa81999ad44a",
                  "version": "KqlParameterItem/1.0",
                  "name": "resourceGroupPicker",
                  "label": "Resource Group",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resourcecontainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| where subscriptionId in~ ({subscriptionPicker})\r\n| project resourceGroup, label = name\r\n| order by label asc",
                  "crossComponentResources": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "ca5d90b1-6a4f-4e96-8835-8b516a7d9773",
                  "version": "KqlParameterItem/1.0",
                  "name": "[parameter(tagPrefix)]Managed",
                  "label": "Managed by [parameter(companyName)]",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"yes\", \"label\":\"yes\" },\r\n    { \"value\":\"no\", \"label\":\"no\" }\r\n]"
                },
                {
                  "id": "2a6e9715-65ac-4e99-8087-36d38c6df94b",
                  "version": "KqlParameterItem/1.0",
                  "name": "resource",
                  "label": "Cosmos DB for PostgreSQL cluster",
                  "type": 5,
                  "isRequired": true,
                  "isGlobal": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type in (\"microsoft.dbforpostgresql/servergroups\", \"microsoft.dbforpostgresql/servergroupsv2\")\r\n| where resourceGroup in ({resourceGroupPicker})\r\n| extend [parameter(tagPrefix)]Managed = iff((tostring(tags) has '\"[parameter(tagPrefix)]Managed\":\"true\"'), \"yes\", \"no\")\r\n| where [parameter(tagPrefix)]Managed in~ ({[parameter(tagPrefix)]Managed})\r\n| project id, name",
                  "crossComponentResources": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type in (\"microsoft.dbforpostgresql/servergroups\", \"microsoft.dbforpostgresql/servergroupsv2\")\r\n| where resourceGroup in~ ({resourceGroupPicker})\r\n| where subscriptionId in ({subscriptionPicker})\r\n| where id in~ ({resource})\r\n| extend rgName = split(id, \"/\", 4)[0]\r\n| extend ['Resource group'] = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', rgName)\r\n| extend Subscription = strcat('/subscriptions/', subscriptionId)\r\n| extend [parameter(tagPrefix)]Managed = iff((tostring(tags) has '\"[parameter(tagPrefix)]Managed\":\"true\"'), \"yes\", \"no\")\r\n| where [parameter(tagPrefix)]Managed in~ ({[parameter(tagPrefix)]Managed}) \r\n| extend ['Status'] = case(properties.state == \"Ready\", \"Available\", properties.state <> \"\", properties.state, properties.state == \"\", \"--\", properties.state)\r\n| extend ['PostgreSQL Version'] = case(type == \"microsoft.dbforpostgresql/servergroupsv2\", properties.postgresqlVersion, \"--\")\r\n| extend ['Citus Version'] = case(type == \"microsoft.dbforpostgresql/servergroupsv2\", properties.citusVersion, \"--\")\r\n| extend ['High Availability'] = case(type == \"microsoft.dbforpostgresql/servergroupsv2\", iff(properties.serverRoleGroups[0].enableHa == true, \"Enabled\", \"Disabled\"), \"--\")\r\n| extend ['Server Edition'] = case(type == \"microsoft.dbforpostgresql/servergroupsv2\", properties.serverRoleGroups[0].serverEdition, \"--\")\r\n| extend ['Server Count'] = case(type == \"microsoft.dbforpostgresql/servergroupsv2\", properties.serverRoleGroups[0].serverCount, \"--\")\r\n| project ['Resource'] = id, ['Name'] = name, ['Status'], ['High Availability'], ['Server Edition'], ['Server Count'], ['PostgreSQL Version'], ['Citus Version'], [parameter(tagPrefix)]Managed, ['Location'] = location, ['Resource group'], Subscription\r\n| sort by (tolower(tostring(['Name']))) asc",
              "size": 1,
              "title": "Cosmos DB for PostgreSQL cluster",
              "noDataMessage": "No resources deployed for chosen environment",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "value::all"
              ],
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "resource",
              "comparison": "isNotEqualTo"
            },
            "name": "resourcelist"
          },
          {
            "type": 1,
            "content": {
              "json": "#### No Cosmos DB for PostgreSQL cluster for selected filter(s) deployed in this environment yet"
            },
            "conditionalVisibility": {
              "parameterName": "resource",
              "comparison": "isEqualTo"
            },
            "name": "noresources"
          }
        ]
      },
      "name": "group - 0",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}