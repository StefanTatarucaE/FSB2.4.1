{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Azure Function Configuration Overview"
      },
      "name": "text - 5"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{subscriptionPicker}"
              ],
              "parameters": [
                {
                  "id": "f5f66862-c38c-4c25-98fa-ad1e7f463a0f",
                  "version": "KqlParameterItem/1.0",
                  "name": "subscriptionPicker",
                  "label": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "includeAll": false,
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all"
                },
                {
                  "id": "b1ae8eeb-0570-482d-af41-aa81999ad44a",
                  "version": "KqlParameterItem/1.0",
                  "name": "resourceGroupPicker",
                  "label": "Resource Group",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| project resourceGroup\r\n| distinct resourceGroup",
                  "crossComponentResources": [
                    "{subscriptionPicker}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "2a6e9715-65ac-4e99-8087-36d38c6df94b",
                  "version": "KqlParameterItem/1.0",
                  "name": "Function",
                  "label": "Azure Function ",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| where resourceGroup in ({resourceGroupPicker})\r\n| project id, name",
                  "crossComponentResources": [
                    "{subscriptionPicker}"
                  ],
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "3b7dce32-00af-4c1e-ab89-b4250e7defa3",
                  "version": "KqlParameterItem/1.0",
                  "name": "OperatingSystem",
                  "label": "Operating System",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "jsonData": "[\"Linux\", \"Windows\"]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "b98cdd1b-3b94-44f3-890e-fa2c4dfa2c06",
                  "version": "KqlParameterItem/1.0",
                  "name": "[parameter(tagPrefix)]Purpose",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "query": "resources\r\n| where type == \"microsoft.web/sites\"\r\n|extend PurposeTaglength = strlen(\"[parameter(tagPrefix)]Purpose\")\r\n| extend [parameter(tagPrefix)]Purpose = iff(tostring(tags) has '\"[parameter(tagPrefix)]Purpose\":', substring((substring (tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]purpose\")+PurposeTaglength+3)),0,indexof(substring(tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]purpose\")+PurposeTaglength+3),'\"')), \"-\")\r\n| extend [parameter(tagPrefix)]Purpose = iif((([parameter(tagPrefix)]Purpose!=\"\") and ([parameter(tagPrefix)]Purpose !startswith \" \")), tostring([parameter(tagPrefix)]Purpose), \"Tag value invalid\")\r\n| project [parameter(tagPrefix)]Purpose\r\n| distinct [parameter(tagPrefix)]Purpose",
                  "crossComponentResources": [
                    "{subscriptionPicker}"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "defaultValue": "value::all",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "cfea8840-7445-43c0-9181-448c3cb0d681",
                  "version": "KqlParameterItem/1.0",
                  "name": "[parameter(tagPrefix)]Managed",
                  "label": "Managed by [parameter(companyName)]",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "showDefault": false
                  },
                  "jsonData": "[\"Yes\", \"No\"]",
                  "defaultValue": "value::all"
                }
              ],
              "style": "above",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| extend OS = iif((kind contains 'linux'),\"Linux\", \"Windows\")\r\n| extend SubscriptionId = split(id,\"/\")[2]\r\n| extend AppServiceplan = tostring(split(properties.serverFarmId,\"/\")[8])\r\n| join kind = leftouter (\r\nResources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend AppServiceplan=tostring(name)\r\n| extend AppserviceplanId=id\r\n) on AppServiceplan\r\n|extend ManagedTaglength = strlen(\"[parameter(tagPrefix)]Managed\")\r\n| extend [parameter(tagPrefix)]ManagedTagValue = iff(\r\n    tostring(tags) has '\"[parameter(tagPrefix)]Managed\":', substring((substring (tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]managed\")+ManagedTaglength+3)),0,indexof(substring(tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]managed\")+ManagedTaglength+3),'\"')), \r\n    \"-\")\r\n| extend [parameter(tagPrefix)]Managed = iif(([parameter(tagPrefix)]ManagedTagValue contains \"true\"), \"Yes\", iif(([parameter(tagPrefix)]ManagedTagValue contains \"[parameter(tagValuePrefixLc)]\"), \"Yes\", \"No\"))\r\n|extend PurposeTaglength = strlen(\"[parameter(tagPrefix)]Purpose\")\r\n| extend [parameter(tagPrefix)]Purpose = iff(\r\n    tostring(tags) has '\"[parameter(tagPrefix)]Purpose\":', substring((substring (tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]purpose\")+PurposeTaglength+3)),0,indexof(substring(tostring(tags), indexof(tolower(tags),\"[parameter(tagPrefixLc)]purpose\")+PurposeTaglength+3),'\"')), \r\n    \"-\")\r\n| extend [parameter(tagPrefix)]Purpose = iif((\r\n    ([parameter(tagPrefix)]Purpose!=\"\") and ([parameter(tagPrefix)]Purpose !startswith \" \")), tostring([parameter(tagPrefix)]Purpose), \r\n    \"Tag value invalid\")\r\n| where resourceGroup in ({resourceGroupPicker})\r\n| where id in ({Function})\r\n| where OS in ({OperatingSystem})\r\n| where [parameter(tagPrefix)]Purpose in ({[parameter(tagPrefix)]Purpose})\r\n| where [parameter(tagPrefix)]Managed in ({[parameter(tagPrefix)]Managed})\r\n| project Name=id, Subscription=SubscriptionId, ResourceGroup=resourceGroup, Location=location, ['Operating System'] = OS, DefaultHostname= properties.defaultHostName, AppserviceplanId, [parameter(tagPrefix)]Purpose, [parameter(tagPrefix)]Managed, Status=properties.state",
              "size": 0,
              "noDataMessage": "No app services found that meet the selected filters",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{subscriptionPicker}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "[parameter(tagPrefix)]Purpose",
                    "formatter": 0,
                    "tooltipFormat": {
                      "tooltip": "[parameter(tagPrefix)]Purpose tag provides a description for resources that are  deployed by [parameter(companyName)] for management  purposes"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "startsWith",
                          "thresholdValue": "Running",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "startsWith",
                          "thresholdValue": "Stopped",
                          "representation": "stopped",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SubscriptionId",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": null,
                      "showIcon": true
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "ResourceGroup",
                    "label": "Resource Group"
                  },
                  {
                    "columnId": "AppserviceplanId",
                    "label": "App service plan"
                  }
                ]
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "resourceGroupPicker",
              "comparison": "isNotEqualTo"
            },
            "name": "query - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "#### No Azure Functions are deployed in this environment yet"
            },
            "conditionalVisibility": {
              "parameterName": "resourceGroupPicker",
              "comparison": "isEqualTo"
            },
            "name": "text - 2"
          },
          {
            "type": 1,
            "content": {
              "json": "## \t\r\n## \t\r\n## Azure Function Workloads"
            },
            "name": "text - 5"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ccd5adcd-8d59-4cfe-99ec-98075de2e253",
                  "version": "KqlParameterItem/1.0",
                  "name": "DefaultSubscription_Internal",
                  "type": 1,
                  "isRequired": true,
                  "query": "where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| take 1\r\n| project subscriptionId",
                  "crossComponentResources": [
                    "value::selected"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "1ca69445-60fc-4806-b43d-ac7e6aad630a",
                  "version": "KqlParameterItem/1.0",
                  "name": "Subscription",
                  "type": 6,
                  "isRequired": true,
                  "query": "where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)\r\n",
                  "crossComponentResources": [
                    "value::selected"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "86066f62-07ec-4cf6-be3a-34cfc4c96d8b",
                  "version": "KqlParameterItem/1.0",
                  "name": "DefaultFunction_Internal",
                  "type": 1,
                  "isRequired": true,
                  "query": "where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| take 1\r\n| project name",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "isHiddenWhenLocked": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "e94aafa3-c5d9-4523-89f0-4e87aa754511",
                  "version": "KqlParameterItem/1.0",
                  "name": "Function",
                  "label": "Azure Function",
                  "type": 5,
                  "isRequired": true,
                  "query": "where type == \"microsoft.web/sites\"\r\n| where kind contains 'functionapp'\r\n| summarize by name, id\r\n| project value = id, label = name, selected = iff(name =~ '{DefaultFunction_Internal}', true, false)",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "typeSettings": {
                    "resourceTypeFilter": {
                      "microsoft.web/sites": true
                    },
                    "additionalResourceOptions": [],
                    "showDefault": false
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                {
                  "id": "c4b69c01-2263-4ada-8d9c-43433b739ff3",
                  "version": "KqlParameterItem/1.0",
                  "name": "TimeRange",
                  "type": 4,
                  "value": {
                    "durationMs": 86400000
                  },
                  "typeSettings": {
                    "selectableValues": [
                      {
                        "durationMs": 3600000
                      },
                      {
                        "durationMs": 14400000
                      },
                      {
                        "durationMs": 43200000
                      },
                      {
                        "durationMs": 86400000
                      },
                      {
                        "durationMs": 172800000
                      },
                      {
                        "durationMs": 259200000
                      },
                      {
                        "durationMs": 604800000
                      },
                      {
                        "durationMs": 1209600000
                      },
                      {
                        "durationMs": 2592000000
                      }
                    ],
                    "allowCustom": true
                  }
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "conditionalVisibility": {
              "parameterName": "selectedTab",
              "comparison": "isNotEqualTo",
              "value": "Overview"
            },
            "name": "parameters - 1"
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook636553a3-092c-4b29-936a-1ab0596a61e2",
              "version": "MetricsItem/2.0",
              "size": 0,
              "chartType": 2,
              "resourceType": "microsoft.web/sites",
              "metricScope": 0,
              "resourceParameter": "Function",
              "resourceIds": [
                "{Function}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 86400000
              },
              "metrics": [
                {
                  "namespace": "microsoft.web/sites",
                  "metric": "microsoft.web/sites--MemoryWorkingSet",
                  "aggregation": 1,
                  "splitBy": null,
                  "columnName": ""
                }
              ],
              "title": "Memory working count",
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "customWidth": "33",
            "name": "metric - 1",
            "styleSettings": {
              "margin": "0",
              "showBorder": true
            }
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbook1faf20d1-7d09-4cff-97e7-799f330cad00",
              "version": "MetricsItem/2.0",
              "size": 0,
              "chartType": 2,
              "resourceType": "microsoft.web/sites",
              "metricScope": 0,
              "resourceParameter": "Function",
              "resourceIds": [
                "{Function}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 86400000
              },
              "metrics": [
                {
                  "namespace": "microsoft.web/sites",
                  "metric": "microsoft.web/sites--FunctionExecutionCount",
                  "aggregation": 1,
                  "splitBy": null
                }
              ],
              "title": "Function Execution Count",
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "customWidth": "33",
            "name": "metric - 6",
            "styleSettings": {
              "maxWidth": "10",
              "showBorder": true
            }
          },
          {
            "type": 10,
            "content": {
              "chartId": "workbooke4e66499-5732-4118-a76a-796a7ff86681",
              "version": "MetricsItem/2.0",
              "size": 0,
              "chartType": 2,
              "resourceType": "microsoft.web/sites",
              "metricScope": 0,
              "resourceParameter": "Function",
              "resourceIds": [
                "{Function}"
              ],
              "timeContextFromParameter": "TimeRange",
              "timeContext": {
                "durationMs": 86400000
              },
              "metrics": [
                {
                  "namespace": "microsoft.web/sites",
                  "metric": "microsoft.web/sites--FunctionExecutionUnits",
                  "aggregation": 1,
                  "splitBy": null
                }
              ],
              "title": "Function Execution Units",
              "gridSettings": {
                "rowLimit": 10000
              }
            },
            "customWidth": "33",
            "name": "metric - 7",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "name": "group - 0"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}